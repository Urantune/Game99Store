<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Giỏ hàng - Game Store</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background: rgba(18, 57, 101, 0.8); background-size: cover; font-family: Arial, sans-serif; }
        .cart-container { max-width: 800px; margin: 50px auto; background: rgba(0, 60, 100, 0.6);
            padding: 20px; border-radius: 15px; box-shadow: 0 8px 20px rgba(0,0,0,0.5); color:#fff; }
        .cart-header { text-align: center; font-size: 28px; font-weight: bold; color:#FFD700; margin-bottom: 20px; }
        table { color:#fff; border-radius: 10px; overflow: hidden; }
        thead { background: linear-gradient(135deg, #002b5c, #004080); color:#fff; }
        .total-row { font-weight: bold; background: rgba(255,215,0,0.2); color:#FFD700; }
        .btn-primary { background: linear-gradient(135deg, #007BFF, #004080); border:none; border-radius:10px; padding:8px 16px; transition: .3s; }
        .btn-primary:hover { background: linear-gradient(135deg, #0056b3, #002b5c); transform: scale(1.05); }
        .btn-success { background: linear-gradient(135deg, #28a745, #006400); border:none; border-radius:10px; padding:8px 16px; transition:.3s; }
        .btn-success:hover { background: linear-gradient(135deg, #218838, #004d00); transform: scale(1.05); }
        .btn-remove { background: linear-gradient(135deg, #ff4d4d, #800000); border:none; border-radius:8px; color:#fff; transition:.3s; }
        .btn-remove:hover { background: linear-gradient(135deg, #cc0000, #660000); transform: scale(1.05); }
        .text-center { color:#ccc; }
    </style>
</head>
<body>
<div class="cart-container">
    <div class="cart-header">Giỏ hàng của bạn</div>

    <table class="table table-hover">
        <thead class="table-dark">
        <tr>
            <th>Lựa chọn</th>
            <th>Game</th>
            <th>Giá</th>
            <th>Chỉnh sửa</th>
        </tr>
        </thead>
        <tbody>
        <!-- Nếu cart rỗng -->
        <tr th:if="${#lists.isEmpty(cart)}">
            <td colspan="4" class="text-center">Giỏ hàng trống</td>
        </tr>

        <!-- Nếu cart có item -->
        <tr th:each="item : ${cart}">
            <td>
                <input type="checkbox"
                       class="game-checkbox"
                       name="selectedGames"
                       th:value="${item.gameId}"
                       th:attr="data-price=${item.price.multiply(T(java.math.BigDecimal).valueOf(item.quantity))}">
            </td>
            <td th:text="${item.gameName}">Tên game</td>
            <td th:text="${#numbers.formatInteger(item.price.multiply(T(java.math.BigDecimal).valueOf(item.quantity)).longValue(),0,'POINT')} + '₫'">0₫</td>
            <td>
                <form th:action="@{/cart/remove}" method="post" style="display:inline;">
                    <input type="hidden" name="gameId" th:value="${item.gameId}">
                    <!-- CSRF (nếu bật Spring Security) -->
                    <input type="hidden" th:if="${_csrf != null}" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                    <button type="submit" class="btn btn-danger btn-sm btn-remove">Xóa</button>
                </form>
            </td>
        </tr>

        <!-- Hàng tổng cộng -->
        <tr class="total-row" th:if="${!#lists.isEmpty(cart)}">
            <td colspan="4" class="text-end">
                Tổng cộng: <strong id="totalPrice">0₫</strong>
            </td>
        </tr>

        </tbody>
    </table>

    <div class="text-end mt-3">
        <a th:href="@{/}" class="btn btn-primary">Tiếp tục mua sắm</a>

        <form th:if="${!#lists.isEmpty(cart)}" th:action="@{/checkout}" method="post" style="display:inline;">
            <input type="hidden" th:if="${_csrf != null}" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
            <button type="submit" class="btn btn-success">Thanh toán</button>
        </form>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const checkboxes = document.querySelectorAll(".game-checkbox");
        const totalPriceEl = document.getElementById("totalPrice");

        function updateTotal() {
            let total = 0;
            checkboxes.forEach(cb => {
                if (cb.checked) {
                    total += parseFloat(cb.getAttribute("data-price"));
                }
            });
            totalPriceEl.textContent = total.toLocaleString("vi-VN") + "₫";
        }

        checkboxes.forEach(cb => cb.addEventListener("change", updateTotal));
        updateTotal(); // tính lần đầu nếu có sẵn lựa chọn
    });
</script>
</body>
</html>
